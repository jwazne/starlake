# Extract

Extract tables in one shot and incrementally from a database as a set of files.


## Prerequisites
It is necessary to load the sample database available in the `sample` folder on Github.

- Postgres
- SQLServer
- MySQL
- Oracle




## Extract Data

Extracting Data involves the following steps:

- Configure the connection to the source database
- Select the database schema to extract
- Select the tables to extract
- Select the columns to extract (optional)
- Select the rows to extract (optional)

### Configure the connection to the source database

In the project folder, under the `metadata` folder,  edit the file application.sl.yml and set the connection parameters to the source database.

```yaml title="metadata/application.sl.yml"
application:
  ...
  connections:
    extract_db:
      type: jdbc
      options:
        url: "jdbc:postgresql:{{EXTRACT_DATABASE}}"
        driver: "org.postgresql.Driver"
        user: "{{EXTRACT_USER}}"
        password: "{{EXTRACT_PASSWORD}}"
        quoteIdentifiers: false

  ...
```

EXTRACT_DATABASE, EXTRACT_USER and EXTRACT_PASSWORD are environment variables that must be set before running the application.

They may be set in the `env.sl.yml` file in the project `metadata` folder or in the environment.

## Select the database schema to extract

```yaml title="metadata/extract/my_extract_config.sl.yml"
extract:
  connectionRef: "extract_db" # The database connection to use
  jdbcSchemas:
    - schema: "sales"
      tables:
        - name: "*"               # table name or simple "*" to extract all tables
      tableTypes:                 # (optional)  the type of tables to extract
        - "TABLE"
        #- "VIEW"
        #- "SYSTEM TABLE"
        #- "GLOBAL TEMPORARY"
        #- "LOCAL TEMPORARY"
        #- "ALIAS"
        #- "SYNONYM"
```
That's it! We are ready to extract the data from the database.

```shell
$ starlake extract-data --config metadata/extract/my_extract_config.sl.yml \
                        --outputDir /tmp/extract/
```

The `/tmp/extract` folder will contain the extracted data in CSV format.

## Select the tables to extract

```yaml title="metadata/extract/my_extract_config.sl.yml"
extract:
  connectionRef: "extract_db" # The database connection to use
  jdbcSchemas:
    - schema: "sales"
      tables:
        - name: "salesorderdetail"              # table name or simple "*" to extract all tables
          partitionColumn: "salesorderdetailid" # (optional)  you may parallelize the extraction based on this field
          fetchSize: 100                        # (optional)  the number of rows to fetch at a time
          timestamp: salesdatetime              # (optional) the timestamp field to use for incremental extraction
      tableTypes:
        - "TABLE"
        #- "VIEW"
        #- "SYSTEM TABLE"
        #- "GLOBAL TEMPORARY"
        #- "LOCAL TEMPORARY"
        #- "ALIAS"
        #- "SYNONYM"
```


## Extract Schema
### Mode Full
### Mode Incremental
## Monitoring (Audit / Last_export)
### Advanced
### Partitioning
### Parrallel ...
### Remarks in DB2 or Oracle
